<Schema name="SDGs and Beyond" metamodelVersion="4.0"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="mondrian.xsd">
    <Annotations>
        <Annotation name="desc">Cube Schema for CCRS - SDGs and Beyond</Annotation>
    </Annotations>

    <PhysicalSchema>
        <!-- ## _SHARED_PHYSICAL_SCHEMA_TAG_ ## -->
        
        <!-- ## _CATEGORY_QUERIES_TAG_ ## -->
        
        <!-- ## _YESNOTABLE_QUERIES_TAG_ ## -->
        
        <Query alias="PartnershipType">
            <ExpressionView>
                <SQL dialect="generic">
                    <![CDATA[SELECT ID, LABEL FROM CATEGORY WHERE DTYPE='PartnershipType']]>
                </SQL>
            </ExpressionView>
        </Query>
        
        <Query alias="AgreementType">
            <ExpressionView>
                <SQL dialect="generic">
                    <![CDATA[SELECT ID, LABEL FROM CATEGORY WHERE DTYPE='AgreementType']]>
                </SQL>
            </ExpressionView>
        </Query>

        <Query alias="CP14UNCTPartners">
            <ExpressionView>
                <SQL dialect="generic">
                    <![CDATA[
                        select
                            M.ID, M.PARTNER_ID, M.PARTNERSHIP_TYPE_ID, M.AGREEMENT_TYPE_ID,
                            CASE WHEN M.MULTINATIONAL_BUSINESS_NAME IS NULL THEN '' ELSE MULTINATIONAL_BUSINESS_NAME END as MULTINATIONAL_BUSINESS_NAME,
                            CP1.DESIGNATION, CP1.ENTITY_YEAR, CP1.COUNTRY_INCOME_STATUS_ID, CP1.SECONDARY_COUNTRY_INCOME_STATUS_ID,
                            CASE WHEN cp1.OFFICIAL_REQUEST_DAO_COUNTRY = TRUE THEN 1 ELSE 0 END as OFFICIAL_REQUEST_DAO_COUNTRY
                        from CP14NONUNPARTNER_SPECIFIC_ACTIVITIES M, CP1GENERAL_PROFILE CP1, BASE_COUNTRY bc, v_cp_validated_designations v
                        WHERE
                            M.PARENT_ID = CP1.ID AND
                            CP1.DESIGNATION != 'AQ' AND CP1.DESIGNATION != 'DOCO' AND CP1.DESIGNATION = bc.iso2 and
                            CP1.designation = v.designation and v.entity_year = CP1.ENTITY_YEAR
                    ]]>
                </SQL>
            </ExpressionView>
        </Query>

        <Query alias="CP14GeneralCube">
            <ExpressionView>
                <SQL dialect="generic">
                    <![CDATA[
                        select                        
                        	CASE WHEN cp14.DOES_GOVERNMENT_HAVE_NATIONAL_STRATEGY = TRUE THEN 1 ELSE 0 END as DOES_GOVERNMENT_HAVE_NATIONAL_STRATEGY,
                        	CASE WHEN cp14.DOES_GOVERNMENT_HAVE_FORMAL_MECHANISMS = TRUE THEN 1 ELSE 0 END as DOES_GOVERNMENT_HAVE_FORMAL_MECHANISMS,
                        	CASE WHEN cp14.DOESUNCTPARTICIPATE = TRUE THEN 1 ELSE 0 END as DOESUNCTPARTICIPATE,
                        	CASE WHEN cp14.INTERAGENCY_EFFORT = TRUE THEN 1 ELSE 0 END as INTERAGENCY_EFFORT,
                        	CASE WHEN cp14.INTERAGENCY_GROUP = TRUE THEN 1 ELSE 0 END as INTERAGENCY_GROUP,
                        	CASE WHEN cp14.BUDGET_ACTIVITY = TRUE THEN 1 ELSE 0 END as BUDGET_ACTIVITY,
                        	CASE WHEN cp14.COMMON_INTERAGENCY_WORKPLAN = TRUE THEN 1 ELSE 0 END as COMMON_INTERAGENCY_WORKPLAN,
                        	CASE WHEN cp14.USEIATISTANDARDS = TRUE THEN 1 ELSE 0 END as USEIATISTANDARDS,
                            cp14.ID, cp14.DESIGNATION, cp14.ENTITY_YEAR, CP1.COUNTRY_INCOME_STATUS_ID, CP1.SECONDARY_COUNTRY_INCOME_STATUS_ID,
                            CASE WHEN cp14.JOINTUNCTEFFORT = TRUE THEN 1 ELSE 0 END as JOINTUNCTEFFORT,
                            CASE WHEN cp14.HAS_SUPPORT_TO_NATIONAL_STATS_CAPACITY = TRUE THEN 1 ELSE 0 END as HAS_SUPPORT_TO_NATIONAL_STATS_CAPACITY,
                            CASE WHEN cp14.HAS_INNOVATION_CITIZEN_ENGAGEMENT_CROWDSOURCING = TRUE THEN 1 ELSE 0 END as HAS_INNOVATION_CITIZEN_ENGAGEMENT_CROWDSOURCING,
                            CASE WHEN cp14.HAS_NONUNPARTNERS_SPECIFIC_ACTIVITIES = TRUE THEN 1 ELSE 0 END as HAS_NONUNPARTNERS_SPECIFIC_ACTIVITIES,
                            CASE WHEN cp14.HAS_GOVERNMENT_REQUESTED_SUPPORT_ON_NATL_RESPONSESDG = TRUE THEN 1 ELSE 0 END as HAS_GOVERNMENT_REQUESTED_SUPPORT_ON_NATL_RESPONSESDG,
                            CASE WHEN cp14.HAS_OPEN_DATA_TRANSPARENCY_POLICIES = TRUE THEN 1 ELSE 0 END as HAS_OPEN_DATA_TRANSPARENCY_POLICIES,
                            CASE WHEN cp14.PARTICIPATES_IN_CROSS_BORDER_INITIATIVES = TRUE THEN 1 ELSE 0 END as PARTICIPATES_IN_CROSS_BORDER_INITIATIVES,
                            CASE WHEN cp1.OFFICIAL_REQUEST_DAO_COUNTRY = TRUE THEN 1 ELSE 0 END as OFFICIAL_REQUEST_DAO_COUNTRY
                        from CP14EMERGING_ISSUES cp14, CP1GENERAL_PROFILE cp1, BASE_COUNTRY bc, v_cp_validated_designations v
                        WHERE
                            cp14.DESIGNATION = cp1.DESIGNATION AND cp14.ENTITY_YEAR = cp1.ENTITY_YEAR AND
                            cp14.DESIGNATION != 'AQ' AND cp14.DESIGNATION != 'DOCO' AND cp14.DESIGNATION = bc.iso2 and
                            cp14.designation = v.designation and v.entity_year = cp14.ENTITY_YEAR
                    ]]>
                </SQL>
            </ExpressionView>
        </Query>
    </PhysicalSchema>
    
    <!--*************************************************************************
    ***** Shared Dimensions
    *************************************************************************-->
    <!-- ## _SHARED_DIMENSIONS_TAG_ ## -->

    <!--*************************************************************************
    ***** CP14 UNCT Partners
    *************************************************************************-->
    <Cube name="UNCTPartners" caption="UNCT Partners" visible="true"
          cache="true" enabled="true" defaultMeasure="Count">
        <Dimensions>
            <Dimension source="Region" />
            <Dimension source="Country" />
            <Dimension source="Delivering as One" />
            <Dimension name="Year" caption="Year" table="CP14UNCTPartners" visible="true">
                <Attributes>
                    <Attribute name="Year" keyColumn="ENTITY_YEAR" datatype="Integer" />
                </Attributes>
            </Dimension>
            <Dimension source="CountryIncomeStatus" />
            <Dimension source="SecondaryCountryIncomeStatus" />

            <Dimension source="CATEGORY" table="LocalInstitution" name="Partner" caption="Partner" />
            
            <Dimension name="Multinational business name" caption="Name of the Multinational business"
                       table="CP14UNCTPartners" visible="true">
                 <Attributes>
                    <Attribute name="Multinational business name" caption="Name of the Multinational business"
                               keyColumn="MULTINATIONAL_BUSINESS_NAME"
                               hierarchyAllMemberName="All Multinational business names"
                               hierarchyCaption="All Multinational business names" 
                               levelType="Regular" datatype="String" >
                    </Attribute>
                </Attributes>
            </Dimension>
            
            <Dimension name="Partnership Type" caption="Partnership Type" table="PartnershipType"
                       key="Dimension Id" visible="true">
                <Attributes>
                    <Attribute name="Dimension Id" keyColumn="ID"
                               hasHierarchy="false" levelType="Regular" datatype="Integer" />

                    <Attribute name="Partnership Type" caption="Partnership Type" keyColumn="LABEL"
                               hierarchyAllMemberName="All Partnership Types" hierarchyCaption="All Partnership Types"
                               levelType="Regular" datatype="String" />
                </Attributes>
            </Dimension>
            
            <Dimension name="Agreement Type" caption="Agreement Type" table="AgreementType"
                       key="Dimension Id" visible="true">
                <Attributes>
                    <Attribute name="Dimension Id" keyColumn="ID"
                               hasHierarchy="false" levelType="Regular" datatype="Integer" />

                    <Attribute name="Agreement Type" caption="Agreement Type" keyColumn="LABEL"
                               hierarchyAllMemberName="All Agreement Types" hierarchyCaption="All Agreement Types"
                               levelType="Regular" datatype="String" />
                </Attributes>
            </Dimension>
        </Dimensions>

        <MeasureGroups>
            <MeasureGroup name="CP14 UNCT Partners Measures" table="CP14UNCTPartners">
                <Measures>
                    <Measure name="Count" caption="Number of UNCT Partners" column="ID" datatype="Integer"
                             aggregator="distinct-count" visible="true" formatString="#,###"/>
                </Measures>
                <DimensionLinks>
                    <!-- ## _SHARED_DIMENSIONS_LINKS_TAG_ ## -->
                    <ForeignKeyLink dimension="Partner"  foreignKeyColumn="PARTNER_ID"/>
                </DimensionLinks>
            </MeasureGroup>
        </MeasureGroups>
    </Cube>

    <!--*************************************************************************
    ***** CP14 General Cube
    *************************************************************************-->
    <Cube name="SDGs and Beyond" caption="SDGs and Beyond" visible="true"
          cache="true" enabled="true" defaultMeasure="Count">
        <Dimensions>
            <Dimension source="Region" />
            <Dimension source="Country" />
            <Dimension source="Delivering as One" />
            <Dimension name="Year" caption="Year" table="CP14GeneralCube" visible="true">
                <Attributes>
                    <Attribute name="Year" keyColumn="ENTITY_YEAR" datatype="Integer" />
                </Attributes>
            </Dimension>
            <Dimension source="CountryIncomeStatus" />
            <Dimension source="SecondaryCountryIncomeStatus" />

            <Dimension table="YesNoTable" name="DOES_GOVERNMENT_HAVE_NATIONAL_STRATEGY" caption="Does the government have an updated and operational National Strategy for the Development of Statistics?" />
            <Dimension table="YesNoTable" name="DOES_GOVERNMENT_HAVE_FORMAL_MECHANISMS" caption="Does the government have formal mechanisms to coordinate statistical development efforts with development partners, including the United Nations?" />
            <Dimension table="YesNoTable" name="DOESUNCTPARTICIPATE" caption="Does the UNCT participate in this mechanism?" />
            <Dimension table="YesNoTable" name="Support to national statistical capacity" caption="Does the UNCT provide support to national statistical capacity?" />
            <Dimension table="YesNoTable" name="INTERAGENCY_EFFORT" caption="Is this an interagency effort?" />
            <Dimension table="YesNoTable" name="INTERAGENCY_GROUP" caption="Is there an interagency group on data and statistics?" />
            <Dimension table="YesNoTable" name="BUDGET_ACTIVITY" caption="Is there a budget for this activity?" />
            <Dimension table="YesNoTable" name="COMMON_INTERAGENCY_WORKPLAN" caption="Is there a common interagency workplan for this activity?" />
            <Dimension table="YesNoTable" name="Citizen engagement or other crowd-sourcing" caption="Does the UNCT apply innovation during UN country programming?" />
            <Dimension table="YesNoTable" name="JOINTUNCTEFFORT" caption="Is it a joint UNCT effort? (applying innovation)" />
            <Dimension table="YesNoTable" name="UNCT convene partners beyond the UN" caption="Does your UNCT convene partners beyond the UN for specific policy activities?" />
            <Dimension table="YesNoTable" name="Sustainable Development Goals" caption="Has your government requested support on their national response to Sustainable Development Goals?" />
            <Dimension table="YesNoTable" name="Data/transparency policies or portals" caption="Does the UNCT have open data/transparency portals?" />
            <Dimension table="YesNoTable" name="USEIATISTANDARDS" caption="Do you use IATI standards in the portal?" />
            <Dimension table="YesNoTable" name="Cross-border initiatives" caption="Does your UNCT participate in cross-border initiatives?" />
        </Dimensions>

        <MeasureGroups>
            <MeasureGroup name="CP14 General Cube Measures" table="CP14GeneralCube">
                <Measures>
                    <Measure name="Count" caption="Number of Country Records Submitted" column="ID" datatype="Integer"
                             aggregator="distinct-count" visible="true" formatString="#,###"/>

                    <!--14.A-->
                    <Measure name="DOES_GOVERNMENT_HAVE_NATIONAL_STRATEGY" caption="Count of 'Does the government have an updated and operational National Strategy for the Development of Statistics?'" column="DOES_GOVERNMENT_HAVE_NATIONAL_STRATEGY"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.B-->
                    <Measure name="DOES_GOVERNMENT_HAVE_FORMAL_MECHANISMS" caption="Count of 'Does the government have formal mechanisms to coordinate statistical development efforts with development partners, including the United Nations?'" column="DOES_GOVERNMENT_HAVE_FORMAL_MECHANISMS"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.B.1-->
                    <Measure name="DOESUNCTPARTICIPATE" caption="Count of 'Does the UNCT participate in this mechanism?'" column="DOESUNCTPARTICIPATE"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.1-->
                    <Measure name="SupportNationalstatisticalcapacity" caption="Count of UNCT provide support to national statistical capacity" column="HAS_SUPPORT_TO_NATIONAL_STATS_CAPACITY"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.1.1.A-->
                    <Measure name="INTERAGENCY_EFFORT" caption="Count of 'Is this an interagency effort?'" column="INTERAGENCY_EFFORT"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.1.1.A.1-->
                    <Measure name="INTERAGENCY_GROUP" caption="Count of 'Is there an interagency group on data and statistics?'" column="INTERAGENCY_GROUP"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.1.1.A.2-->
                    <Measure name="BUDGET_ACTIVITY" caption="Count of 'Is there a budget for this activity?'" column="BUDGET_ACTIVITY"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.1.1.A.3-->
                    <Measure name="COMMON_INTERAGENCY_WORKPLAN" caption="Count of 'Is there a common interagency workplan for this activity?'" column="COMMON_INTERAGENCY_WORKPLAN"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.2-->
                    <Measure name="CitizenEngagementCrowdSourcing" caption="Count of 'Does the UNCT apply innovation during UN country programming?'" column="HAS_INNOVATION_CITIZEN_ENGAGEMENT_CROWDSOURCING"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.2.A-->
                    <Measure name="JOINTUNCTEFFORT" caption="Count of 'Is it a joint UNCT effort?' (applying innovation)" column="JOINTUNCTEFFORT"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.3-->
                    <Measure name="UNCTConvenePartnersBeyondUN" caption="Count of UNCT convene partners beyond the UN for specific policy activities" column="HAS_NONUNPARTNERS_SPECIFIC_ACTIVITIES"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.4-->
                    <Measure name="SustainableDevelopmentGoals" caption="Count of government requested support on their national response to Sustainable Development Goals" column="HAS_GOVERNMENT_REQUESTED_SUPPORT_ON_NATL_RESPONSESDG"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.5-->
                    <Measure name="DataRransparencyPoliciesPortals" caption="Count of 'Does the UNCT have open data/transparency portals?'" column="HAS_OPEN_DATA_TRANSPARENCY_POLICIES"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.5.A-->
                    <Measure name="USEIATISTANDARDS" caption="Count of 'Do you use IATI standards in the portal?'" column="USEIATISTANDARDS"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <!--14.6-->
                    <Measure name="CrossBorderInitiatives" caption="Count of UNCT participate in cross-border initiatives" column="PARTICIPATES_IN_CROSS_BORDER_INITIATIVES"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>
                </Measures>
                <DimensionLinks>
                    <!-- ## _SHARED_DIMENSIONS_LINKS_TAG_ ## -->
                    <ForeignKeyLink dimension="Support to national statistical capacity" foreignKeyColumn="HAS_SUPPORT_TO_NATIONAL_STATS_CAPACITY"/>
                    <ForeignKeyLink dimension="Citizen engagement or other crowd-sourcing" foreignKeyColumn="HAS_INNOVATION_CITIZEN_ENGAGEMENT_CROWDSOURCING"/>
                    <ForeignKeyLink dimension="UNCT convene partners beyond the UN" foreignKeyColumn="HAS_NONUNPARTNERS_SPECIFIC_ACTIVITIES"/>
                    <ForeignKeyLink dimension="Sustainable Development Goals" foreignKeyColumn="HAS_GOVERNMENT_REQUESTED_SUPPORT_ON_NATL_RESPONSESDG"/>
                    <ForeignKeyLink dimension="Data/transparency policies or portals" foreignKeyColumn="HAS_OPEN_DATA_TRANSPARENCY_POLICIES"/>
                    <ForeignKeyLink dimension="Cross-border initiatives" foreignKeyColumn="PARTICIPATES_IN_CROSS_BORDER_INITIATIVES"/>
                    <ForeignKeyLink dimension="DOES_GOVERNMENT_HAVE_NATIONAL_STRATEGY" foreignKeyColumn="DOES_GOVERNMENT_HAVE_NATIONAL_STRATEGY"/>
                    <ForeignKeyLink dimension="DOES_GOVERNMENT_HAVE_FORMAL_MECHANISMS" foreignKeyColumn="DOES_GOVERNMENT_HAVE_FORMAL_MECHANISMS"/>
                    <ForeignKeyLink dimension="DOESUNCTPARTICIPATE" foreignKeyColumn="DOESUNCTPARTICIPATE"/>
                    <ForeignKeyLink dimension="INTERAGENCY_EFFORT" foreignKeyColumn="INTERAGENCY_EFFORT"/>
                    <ForeignKeyLink dimension="INTERAGENCY_GROUP" foreignKeyColumn="INTERAGENCY_GROUP"/>
                    <ForeignKeyLink dimension="BUDGET_ACTIVITY" foreignKeyColumn="BUDGET_ACTIVITY"/>
                    <ForeignKeyLink dimension="COMMON_INTERAGENCY_WORKPLAN" foreignKeyColumn="COMMON_INTERAGENCY_WORKPLAN"/>	
                    <ForeignKeyLink dimension="USEIATISTANDARDS" foreignKeyColumn="USEIATISTANDARDS"/>
					<ForeignKeyLink dimension="JOINTUNCTEFFORT" foreignKeyColumn="JOINTUNCTEFFORT"/>                               
                </DimensionLinks>
            </MeasureGroup>
        </MeasureGroups>
    </Cube>
</Schema>
