<Schema name="Development Effectiveness Profile" metamodelVersion="4.0"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="mondrian.xsd">
    <Annotations>
        <Annotation name="desc">Cube Schema for CCRS - Development Effectiveness Profile</Annotation>
    </Annotations>

    <PhysicalSchema>
        <!-- ## _SHARED_PHYSICAL_SCHEMA_TAG_ ## -->
        
        <!-- ## _CATEGORY_QUERIES_TAG_ ## -->
        
        <!-- ## _YESNOTABLE_QUERIES_TAG_ ## -->
        
        <Query alias="CP11BudgetSupport">
            <ExpressionView>
                <SQL dialect="generic">
                    <![CDATA[
                        select
                            D.*, CP11.DESIGNATION, CP11.ENTITY_YEAR, CP1.COUNTRY_INCOME_STATUS_ID, CP1.SECONDARY_COUNTRY_INCOME_STATUS_ID,
                            CASE cp1.OFFICIAL_REQUEST_DAO_COUNTRY WHEN TRUE THEN 1 WHEN FALSE THEN 0 ELSE -1 END as OFFICIAL_REQUEST_DAO_COUNTRY
                        from CP11DEVELOPMENT_EFFECTIVENESS_PROFILE CP11, CP11DIRECT_BUDGET_SUPPORT D, CP1GENERAL_PROFILE CP1, BASE_COUNTRY bc, v_cp_validated_designations v
                        WHERE
                            CP11.DESIGNATION = CP1.DESIGNATION AND CP11.ENTITY_YEAR = CP1.ENTITY_YEAR AND
                            CP11.ID = D.PARENT_ID AND
                            CP11.DESIGNATION != 'AQ' AND CP11.DESIGNATION != 'DOCO' AND CP11.DESIGNATION = bc.iso2 AND
                            CP11.designation = v.designation and v.entity_year = CP11.ENTITY_YEAR AND
                            CP11.HAS_DIRECT_BUDGET_SUPPORT = true
                    ]]>
                </SQL>
            </ExpressionView>
        </Query>

        <Query alias="CP11GeneralCube">
            <ExpressionView>
                <SQL dialect="generic">
                    <![CDATA[
                        select
                            cp11.ID, cp11.DESIGNATION, cp11.ENTITY_YEAR, CP1.COUNTRY_INCOME_STATUS_ID, CP1.SECONDARY_COUNTRY_INCOME_STATUS_ID, 
                            CASE WHEN cp11.HAS_SUPPORTSSCOOPERATION = TRUE THEN 1 ELSE 0 END as HAS_SUPPORTSSCOOPERATION_COUNT,
                            CASE cp11.HAS_SUPPORTSSCOOPERATION WHEN TRUE THEN 1 WHEN FALSE THEN 0 ELSE -1 END as HAS_SUPPORTSSCOOPERATION,
                            HASSWAPS_ID,
                            CASE WHEN cp11.HAS_DIRECT_BUDGET_SUPPORT = TRUE THEN 1 ELSE 0 END as HAS_DIRECT_BUDGET_SUPPORT_COUNT,
                            CASE cp11.HAS_DIRECT_BUDGET_SUPPORT WHEN TRUE THEN 1 WHEN FALSE THEN 0 ELSE -1 END as HAS_DIRECT_BUDGET_SUPPORT,
                            CASE WHEN cp11.IS_CHAIR_AID_EFFECTIVENESS_FORA = TRUE THEN 1 ELSE 0 END as IS_CHAIR_AID_EFFECTIVENESS_FORA_COUNT,
                            CASE cp11.IS_CHAIR_AID_EFFECTIVENESS_FORA WHEN TRUE THEN 1 WHEN FALSE THEN 0 ELSE -1 END as IS_CHAIR_AID_EFFECTIVENESS_FORA,
                            CASE WHEN cp11.HAS_CAPACITY_FOR_AID_MODALITIES = TRUE THEN 1 ELSE 0 END as HAS_CAPACITY_FOR_AID_MODALITIES_COUNT,
                            CASE cp11.HAS_CAPACITY_FOR_AID_MODALITIES WHEN TRUE THEN 1 WHEN FALSE THEN 0 ELSE -1 END as HAS_CAPACITY_FOR_AID_MODALITIES,
                            CASE WHEN cp11.HASAIMS = TRUE THEN 1 ELSE 0 END as HASAIMS_COUNT,
                            CASE cp11.HASAIMS WHEN TRUE THEN 1 WHEN FALSE THEN 0 ELSE -1 END as HASAIMS,
                            CASE WHEN cp11aims.SUPPORTED_BYUN = TRUE THEN 1 ELSE 0 END as SUPPORTED_BYUN_COUNT,
                            CASE cp11aims.SUPPORTED_BYUN WHEN TRUE THEN 1 WHEN FALSE THEN 0 ELSE -1 END as SUPPORTED_BYUN,
                            CASE WHEN cp11aims.UNCT_REPORT_TOAIMS = TRUE THEN 1 ELSE 0 END as UNCT_REPORT_TOAIMS_COUNT,
                            CASE cp11aims.UNCT_REPORT_TOAIMS WHEN TRUE THEN 1 WHEN FALSE THEN 0 ELSE -1 END as UNCT_REPORT_TOAIMS,
                            CASE cp1.OFFICIAL_REQUEST_DAO_COUNTRY WHEN TRUE THEN 1 WHEN FALSE THEN 0 ELSE -1 END as OFFICIAL_REQUEST_DAO_COUNTRY,
                            CASE WHEN cp11.HAS_GOV_REQUESTEDSSCOOPERATION_SUPPORT = TRUE THEN 1 ELSE 0 END as HAS_GOV_REQUESTEDSSCOOPERATION_SUPPORT_COUNT,
                            CASE cp11.HAS_GOV_REQUESTEDSSCOOPERATION_SUPPORT WHEN TRUE THEN 1 WHEN FALSE THEN 0 ELSE -1 END as HAS_GOV_REQUESTEDSSCOOPERATION_SUPPORT,
                            cp11supportsscooperation.ROLE_ID,
                            cp11supportsscooperation.COLLECTIVE_APPROACH_ID 
                        from CP11DEVELOPMENT_EFFECTIVENESS_PROFILE cp11, CP1GENERAL_PROFILE cp1, CP11AIMS cp11aims, BASE_COUNTRY bc, v_cp_validated_designations v,
                            CP11SUPPORTSSCOOPERATION cp11supportsscooperation
                        WHERE
                            cp11.DESIGNATION = cp1.DESIGNATION AND cp11.ENTITY_YEAR = cp1.ENTITY_YEAR AND
                            CP11AIMS.PARENT_ID = cp11.id AND
                            CP11.ID = cp11supportsscooperation.PARENT_ID AND
                            cp11.DESIGNATION != 'AQ' AND cp11.DESIGNATION != 'DOCO' AND cp11.DESIGNATION = bc.iso2 and
                            cp11.designation = v.designation and v.entity_year = cp11.ENTITY_YEAR
                    ]]>
                </SQL>
            </ExpressionView>
        </Query>
    </PhysicalSchema>

    <!--*************************************************************************
    ***** Shared Dimensions
    *************************************************************************-->
    <!-- ## _SHARED_DIMENSIONS_TAG_ ## -->
    
    <!--*************************************************************************
    ***** CP11 Budget Support
    *************************************************************************-->
    <Cube name="Budget Support" caption="Budget Support" visible="true"
          cache="true" enabled="true" defaultMeasure="Count">
        <Dimensions>
            <Dimension source="Region" />
            <Dimension source="Country" />
            <Dimension source="Delivering as One" />
            <Dimension name="Year" caption="Year" table="CP11BudgetSupport" visible="true">
                <Attributes>
                    <Attribute name="Year" keyColumn="ENTITY_YEAR" datatype="Integer" />
                </Attributes>
            </Dimension>
            <Dimension source="CountryIncomeStatus" />
            <Dimension source="SecondaryCountryIncomeStatus" />

            <Dimension source="CATEGORY" table="Sector" name="Sector" caption="Sector" />
        </Dimensions>

        <MeasureGroups>
            <MeasureGroup name="CP Budget Support Measures" table="CP11BudgetSupport">
                <Measures>
                    <Measure name="Count" caption="Number of Budget Supports" column="ID" datatype="Integer"
                             aggregator="distinct-count" visible="true" formatString="#,###"/>

                    <Measure name="Budget Support" caption="Direct Budget Support" column="BUDGETED_AMOUNT"
                             datatype="Numeric" aggregator="sum" visible="true" formatString="#,###"/>
                </Measures>
                <DimensionLinks>
                    <!-- ## _SHARED_DIMENSIONS_LINKS_TAG_ ## -->
                    <ForeignKeyLink dimension="Sector" foreignKeyColumn="SECTOR_ID" />
                </DimensionLinks>
            </MeasureGroup>
        </MeasureGroups>
    </Cube>

    <!--*************************************************************************
    ***** CP11 General Cube
    *************************************************************************-->
    <Cube name="Development Effectiveness" caption="Development Effectiveness Profile" visible="true"
          cache="true" enabled="true" defaultMeasure="Count">
        <Dimensions>
            <Dimension source="Region" />
            <Dimension source="Country" />
            <Dimension source="Delivering as One" />
            <Dimension name="Year" caption="Year" table="CP11GeneralCube" visible="true">
                <Attributes>
                    <Attribute name="Year" keyColumn="ENTITY_YEAR" datatype="Integer" />
                </Attributes>
            </Dimension>
            <Dimension source="CountryIncomeStatus" />
            <Dimension source="SecondaryCountryIncomeStatus" />

            <Dimension table="YesNoTable" name="South-South Cooperation" caption="Does the UNCT provide support on South-South Cooperation?" />
            <Dimension source="CATEGORY" table="YesNoNAQuestion" name="SWAPs" caption="Does the UNCT participate in sector-wide approaches (SWAPs)?" />
            <Dimension table="YesNoTable" name="Direct budget support" caption="Does the UNCT provide direct budget support?" />
            <Dimension table="YesNoTable" name="Chair/co-chair aid effectiveness" caption="Does the UNCT chair/co-chair aid effectiveness and coordination fora?" />
            <Dimension table="YesNoTable" name="Capacity development for aid modalities" caption="Does the UNCT provide capacity development for use of aid modalities and aid management?" />
            <Dimension table="YesNoTable" name="AIMS" caption="Is there an Aid Management Information System (AIMS) in place?" />
            <Dimension table="YesNoTable" name="Is the system supported by the UNCT" caption="Is the system supported by the UNCT?" />
            <Dimension table="YesNoTable" name="Does the UNCT report to the AIMS" caption="Does the UNCT report to the AIMS?" />
            <Dimension table="YesNoTable" name="Did UN Requested Cooperation" caption="Has the government requested the UN system to support its cooperation with other developing countries?" />
            <Dimension source="CATEGORY" table="SSSupportRole" name="supportRole" caption="South-South Support Role" />
            <Dimension source="CATEGORY" table="CollectiveApproachToSSCooperation" name="collectiveApproach" caption="Is the UNCT taking a collective approach to South-South cooperation?" />

        </Dimensions>

        <MeasureGroups>
            <MeasureGroup name="CP11 General Cube Measures" table="CP11GeneralCube">
                <Measures>
                    <Measure name="Count" caption="Number of Country Records Submitted" column="ID" datatype="Integer"
                             aggregator="distinct-count" visible="true" formatString="#,###"/>

                    <Measure name="SouthSouthCooperation" caption="Count of UNCT provide support on South-South Cooperation" column="HAS_SUPPORTSSCOOPERATION_COUNT"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <Measure name="DirectBudgetSupport" caption="Count of UNCT provide direct budget support" column="HAS_DIRECT_BUDGET_SUPPORT_COUNT"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <Measure name="ChairCochairAidEffectiveness" caption="Count of UNCT chair/co-chair aid effectiveness and coordination fora" column="IS_CHAIR_AID_EFFECTIVENESS_FORA_COUNT"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <Measure name="CapacityDevelopment for aid modalities" caption="Count of UNCT provide capacity development for use of aid modalities and aid management" column="HAS_CAPACITY_FOR_AID_MODALITIES_COUNT"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <Measure name="AIMS" caption="Count of Aid Management Information System (AIMS)" column="HASAIMS_COUNT"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <Measure name="supportedByUN" caption="Count of 'Is the system supported by the UNCT?'" column="SUPPORTED_BYUN_COUNT"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <Measure name="unctReportToAIMS" caption="Count of 'Does the UNCT report to the AIMS?'" column="UNCT_REPORT_TOAIMS_COUNT"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>

                    <Measure name="unRequestedCooperation" caption="Count of 'Has the government requested the UN system to support its cooperation with other developing countries?'" column="HAS_GOV_REQUESTEDSSCOOPERATION_SUPPORT_COUNT"
                             datatype="Integer" aggregator="sum" visible="true" formatString="#,###"/>
                </Measures>
                <DimensionLinks>
                    <!-- ## _SHARED_DIMENSIONS_LINKS_TAG_ ## -->
                    <ForeignKeyLink dimension="South-South Cooperation" foreignKeyColumn="HAS_SUPPORTSSCOOPERATION"/>
                    <ForeignKeyLink dimension="SWAPs" foreignKeyColumn="HASSWAPS_ID"/>
                    <ForeignKeyLink dimension="Direct budget support" foreignKeyColumn="HAS_DIRECT_BUDGET_SUPPORT"/>
                    <ForeignKeyLink dimension="Chair/co-chair aid effectiveness" foreignKeyColumn="IS_CHAIR_AID_EFFECTIVENESS_FORA"/>
                    <ForeignKeyLink dimension="Capacity development for aid modalities" foreignKeyColumn="HAS_CAPACITY_FOR_AID_MODALITIES"/>
                    <ForeignKeyLink dimension="AIMS" foreignKeyColumn="HASAIMS"/>
                    <ForeignKeyLink dimension="Is the system supported by the UNCT" foreignKeyColumn="SUPPORTED_BYUN"/>
                    <ForeignKeyLink dimension="Does the UNCT report to the AIMS" foreignKeyColumn="UNCT_REPORT_TOAIMS"/>
                    <ForeignKeyLink dimension="Did UN Requested Cooperation" foreignKeyColumn="HAS_GOV_REQUESTEDSSCOOPERATION_SUPPORT"/>
                    <ForeignKeyLink dimension="supportRole" foreignKeyColumn="ROLE_ID"/>
                    <ForeignKeyLink dimension="collectiveApproach" foreignKeyColumn="COLLECTIVE_APPROACH_ID"/>
                </DimensionLinks>
            </MeasureGroup>
        </MeasureGroups>
    </Cube>
</Schema>